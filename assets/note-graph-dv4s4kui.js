const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-force-graph-2d-Dx-bnKIC.js","assets/index-895OKoX5.js","assets/index-E6mu5I8Q.css","assets/index-Chjiymov.js"])))=>i.map(i=>d[i]);
import{c as L,r as l,al as H,s as O,_ as G,j as o,B as A}from"./index-895OKoX5.js";import{A as I}from"./arrow-left-DPGT24cN.js";import{a as v,F as V}from"./folder-open-jN70IH_R.js";const W=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],$=L("rotate-ccw",W);function C(x){let h=0;for(let g=0;g<x.length;g++)h=x.charCodeAt(g)+((h<<5)-h);return`hsl(${Math.abs(h)%360}, 70%, 55%)`}const U=l.memo(({data:x})=>{const h=H(),k=l.useRef(null),[g,D]=l.useState({width:0,height:0}),{resolvedTheme:E}=O(),j=E==="dark",[P,T]=l.useState(null),[a,w]=l.useState(null),[R,_]=l.useState(null),m=l.useRef(null);l.useEffect(()=>{G(()=>import("./react-force-graph-2d-Dx-bnKIC.js"),__vite__mapDeps([0,1,2,3])).then(n=>{_(()=>n.default)})},[]),l.useEffect(()=>{if(k.current){const n=new ResizeObserver(e=>{const i=e[0];if(!i)return;const{width:t,height:c}=i.contentRect;D({width:t,height:c})});return n.observe(k.current),()=>n.disconnect()}},[]);const S=l.useMemo(()=>j?{note:"#e2e8f0",noteHover:"#60a5fa",text:"#cbd5e1",link:"rgba(226, 232, 240, 0.25)"}:{note:"#334155",noteHover:"#3b82f6",text:"#475569",link:"rgba(45, 55, 72, 0.2)"},[j]),F=l.useMemo(()=>{if(a===null)return{nodes:x.folders.map(e=>({id:e.name,title:e.name.toUpperCase(),type:"folder",noteCount:e.noteCount,color:C(e.name)})),links:[]};{const n=a.split("/"),e=x.folders.find(s=>s.name===n[0]);if(!e)return{nodes:[],links:[]};const i=e.notes,t=a+"/",c=new Set,u=[];i.forEach(s=>{if(!s.id.startsWith(t)&&s.id.split("/").slice(0,n.length).join("/")!==a)return;const r=s.id.split("/"),p=n.length;if(r.length===p+1)u.push({id:s.id,title:s.title,type:"note",color:C(s.id)});else if(r.length>p+1){const b=r.slice(0,p+1).join("/");c.add(b)}});const N=[...Array.from(c).map(s=>{const r=s.split("/").pop()||s,p=i.filter(b=>b.id.startsWith(s+"/")||b.id.startsWith(s)).length;return{id:s,title:r.replace(/-/g," ").toUpperCase(),type:"folder",noteCount:p,color:C(s)}}).sort((s,r)=>s.title.localeCompare(r.title)),...u.sort((s,r)=>s.title.localeCompare(r.title))],f=new Set(u.map(s=>s.id)),y=[];return i.forEach(s=>{f.has(s.id)&&s.links?.forEach(r=>{f.has(r)&&y.push({source:s.id,target:r})})}),{nodes:N,links:y}}},[x,a]),z=l.useCallback(n=>{const e=n;e.type==="folder"?w(e.id):h({to:`/notes/${e.id}`})},[h]),M=l.useCallback(()=>{w(null)},[]),B=l.useCallback(()=>{m.current&&m.current.zoomToFit(400,50)},[]);return l.useEffect(()=>{m.current&&(m.current.d3Force("charge")?.strength(-50),m.current.d3Force("link")?.distance(200),setTimeout(()=>{m.current?.zoomToFit(400,50)},500))},[F]),o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4 shrink-0",children:[a?o.jsxs(o.Fragment,{children:[o.jsxs(A,{variant:"ghost",size:"sm",onClick:M,children:[o.jsx(I,{className:"w-4 h-4 mr-1"}),"Back"]}),o.jsx("span",{className:"text-muted-foreground",children:"/"}),o.jsxs("span",{className:"font-medium flex items-center gap-1",children:[o.jsx(v,{className:"w-4 h-4"}),(a.split("/").pop()||a).toUpperCase()]})]}):o.jsxs("span",{className:"font-medium flex items-center gap-1",children:[o.jsx(v,{className:"w-4 h-4"}),"NOTES"]}),o.jsx("div",{className:"flex-1"}),o.jsxs(A,{variant:"outline",size:"sm",onClick:B,children:[o.jsx($,{className:"w-4 h-4 mr-1"}),"Reset View"]})]}),o.jsx("div",{ref:k,className:"flex-1 min-h-0 rounded-lg border border-border/40 backdrop-blur-md bg-background/80 dark:bg-black/20",children:R?o.jsx(R,{ref:m,width:g.width,height:g.height,graphData:F,onNodeHover:n=>T(n),nodeCanvasObject:(n,e,i)=>{const t=n;if(t.x===void 0||t.y===void 0)return;const c=t.title||t.id,u=P?.id===t.id,d=t.type==="folder",N=d?14:8,f=u?N*1.2:N,y=t.color||"#3b82f6";if(e.beginPath(),d){const r=f*1.8,p=t.x-r/2,b=t.y-r/2;e.roundRect(p,b,r,r,3)}else e.arc(t.x,t.y,f,0,2*Math.PI);e.fillStyle=y,e.fill(),d&&(e.fillStyle=j?"#1e293b":"#ffffff",e.font=`bold ${f*.9}px Sans-Serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(String(t.noteCount||0),t.x,t.y));const s=12/i;e.font=`${s}px Sans-Serif`,e.textAlign="center",e.textBaseline="top",e.fillStyle=S.text,e.fillText(c,t.x,t.y+f+4)},nodePointerAreaPaint:(n,e,i)=>{const t=n;if(t.x===void 0||t.y===void 0)return;const c=t.type==="folder",u=c?14:8;if(i.fillStyle=e,i.beginPath(),c){const d=u*1.8,N=t.x-d/2,f=t.y-d/2;i.fillRect(N,f,d,d)}else i.arc(t.x,t.y,u,0,2*Math.PI),i.fill()},onNodeClick:z,linkColor:()=>S.link,linkWidth:1.5,linkDirectionalArrowLength:6,linkDirectionalArrowRelPos:1,nodeRelSize:8,enableNodeDrag:!0,cooldownTicks:100,d3AlphaDecay:.02,d3VelocityDecay:.3}):o.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Loading graph..."})}),o.jsx("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm text-muted-foreground shrink-0",children:a===null?o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx(v,{className:"w-4 h-4 text-blue-500"}),"Click a folder to explore notes"]}):o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx(V,{className:"w-4 h-4"}),"Click a note to read"]})})]})});U.displayName="NoteGraph";export{U as default};
